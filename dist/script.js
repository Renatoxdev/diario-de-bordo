const STORAGE_KEY="diarioDeBordo:entradas:v1",form=document.getElementById("formEntrada"),inputTitulo=document.getElementById("titulo"),inputData=document.getElementById("data"),inputDescricao=document.getElementById("descricao"),btnLimpar=document.getElementById("btnLimpar"),lista=document.getElementById("lista"),contador=document.getElementById("contador"),estadoVazio=document.getElementById("estadoVazio"),statusEl=document.getElementById("status"),btnInstalar=document.getElementById("btnInstalar");let deferredPrompt=null;function hojeISO(){const t=new Date,e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0");return`${e}-${n}-${a}`}function uid(){return`${Date.now()}-${Math.random().toString(16).slice(2)}`}function lerEntradas(){try{const t=localStorage.getItem(STORAGE_KEY);if(!t)return[];const e=JSON.parse(t);return Array.isArray(e)?e:[]}catch{return[]}}function salvarEntradas(t){localStorage.setItem(STORAGE_KEY,JSON.stringify(t))}function ordenarPorDataDesc(t,e){return t.data===e.data?e.criadoEm-t.criadoEm:t.data<e.data?1:-1}function setStatus(t){statusEl.textContent=t,t&&(window.clearTimeout(setStatus._t),setStatus._t=window.setTimeout(()=>{statusEl.textContent=""},2500))}function formatarDataBR(t){const[e,n,a]=t.split("-");return!e||!n||!a?t:`${a}/${n}/${e}`}function criarItem(t){const e=document.createElement("li");e.className="item",e.dataset.id=t.id;const n=document.createElement("div");n.className="item__top";const a=document.createElement("div"),o=document.createElement("h3");o.className="item__title",o.textContent=t.titulo;const i=document.createElement("p");i.className="item__meta",i.textContent=`Data: ${formatarDataBR(t.data)}`,a.append(o,i);const c=document.createElement("div");c.className="item__actions";const r=document.createElement("button");r.className="btn btn--danger",r.type="button",r.textContent="Remover",r.addEventListener("click",()=>removerEntrada(t.id)),c.append(r),n.append(a,c);const d=document.createElement("p");return d.className="item__desc",d.textContent=t.descricao,e.append(n,d),e}function renderizar(){const t=lerEntradas().sort(ordenarPorDataDesc);lista.innerHTML="",t.forEach(e=>lista.append(criarItem(e))),contador.textContent=String(t.length),estadoVazio.hidden=t.length>0}function limparFormulario(){inputTitulo.value="",inputDescricao.value="",inputData.value=hojeISO(),inputTitulo.focus()}function adicionarEntrada({titulo:t,descricao:e,data:n}){const a=lerEntradas(),o={id:uid(),titulo:t.trim(),descricao:e.trim(),data:n,criadoEm:Date.now()};a.push(o),salvarEntradas(a),renderizar(),setStatus("Entrada adicionada.")}function removerEntrada(t){const n=lerEntradas().filter(a=>a.id!==t);salvarEntradas(n),renderizar(),setStatus("Entrada removida.")}form.addEventListener("submit",t=>{t.preventDefault();const e=inputTitulo.value,n=inputDescricao.value,a=inputData.value;if(!e.trim()||!n.trim()||!a){setStatus("Preencha t\xEDtulo, descri\xE7\xE3o e data.");return}adicionarEntrada({titulo:e,descricao:n,data:a}),limparFormulario()}),btnLimpar.addEventListener("click",()=>{limparFormulario(),setStatus("Formul\xE1rio limpo.")}),window.addEventListener("beforeinstallprompt",t=>{t.preventDefault(),deferredPrompt=t,btnInstalar.hidden=!1}),btnInstalar.addEventListener("click",async()=>{if(deferredPrompt){btnInstalar.hidden=!0,deferredPrompt.prompt();try{await deferredPrompt.userChoice}finally{deferredPrompt=null}}}),window.addEventListener("appinstalled",()=>{setStatus("Aplicativo instalado."),btnInstalar.hidden=!0,deferredPrompt=null}),"serviceWorker"in navigator&&window.addEventListener("load",async()=>{try{await navigator.serviceWorker.register("./service-worker.js")}catch{setStatus("N\xE3o foi poss\xEDvel registrar o Service Worker.")}}),inputData.value=hojeISO(),renderizar();
